{% extends "main.html" %}
{% block pagecontent %}
<h2>{{number}} {{ title}}</h2>

<div id='contributors'></div>
<a class='edit' href='https://github.com/buildingSMART/IFC4.3.x-development/blob/master/{{ path }}'>Edit on Github</a>
<script>
fetch('https://api.github.com/repos/buildingSMART/IFC4.3.x-development/commits?path={{ path }}').then(r => r.json()).then(j => {
  let n = {};
  j.forEach(c => {
    n[c.author.avatar_url] = (n[c.author.avatar_url || 0]) + 1;
  });
  let es = Object.entries(n);
  document.getElementById('contributors').appendChild(
    document.createTextNode(es.length + ' contributor(s): ')
  );
  es.map(kv => [kv[1], kv[0]]).sort().forEach(kv => {
    let img = document.createElement('img');
    img.src = kv[1] + "&s=32";
    img.style.borderRadius = '16px';
    img.style.verticalAlign = 'middle';
    document.getElementById('contributors').appendChild(img);
  });
  console.log(j[0])
  document.getElementById('contributors').innerHTML += '<br />Last change: ' +
  '<em>' + j[0].commit.message + '</em>' + ' by ' + j[0].commit.author.name + ' on ' + (new Date(j[0].commit.author.date)).toLocaleString();
});
</script>

{{ content | safe }}

{% for sub in subs %}

{% if sub is string %}

<a href='../{{ sub | lower }}/content.html'>{{ number }}.{{ loop.index }} {{ sub }}</a><br>

{% else %}

<h3>{{ number }}.{{ loop.index + 1 }} {{ sub[0] }}</h3>

{% set outer_loop = loop %}

{% for ssub in sub[1] %}

<a href='../lexical/{{ ssub }}.htm'>{{ number }}.{{ outer_loop.index + 1 }}.{{ loop.index }} {{ ssub }}</a><br>

{% endfor %}

{% endif %}

{% endfor %}

{% endblock %}
